"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _isSupportedBrowser=_interopRequireDefault(require("./helpers/isSupportedBrowser")),_viewport=require("./helpers/viewport"),_convertToArray3=_interopRequireDefault(require("./helpers/convertToArray")),_parallax=_interopRequireDefault(require("./instances/parallax"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],i=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(e){n=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw o}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var frameID,resizeID,isInit=!1,instances=[],SimpleParallax=function(){function i(e,t){var r;_classCallCheck(this,i),e&&(0,_isSupportedBrowser.default)()&&(this.elements=(0,_convertToArray3.default)(e),this.defaults={delay:0,orientation:"up",scale:1.3,overflow:!1,transition:"cubic-bezier(0,0,0,1)",customContainer:"",customWrapper:"",maxTransition:0},this.settings=Object.assign(this.defaults,t),this.settings.customContainer&&(r=_slicedToArray((0,_convertToArray3.default)(this.settings.customContainer),1),this.customContainer=r[0]),this.lastPosition=-1,this.resizeIsDone=this.resizeIsDone.bind(this),this.refresh=this.refresh.bind(this),this.proceedRequestAnimationFrame=this.proceedRequestAnimationFrame.bind(this),this.init())}return _createClass(i,[{key:"init",value:function(){var t=this;_viewport.viewport.setViewportAll(this.customContainer),instances=[].concat(_toConsumableArray(this.elements.map(function(e){return new _parallax.default(e,t.settings)})),_toConsumableArray(instances)),isInit||(this.proceedRequestAnimationFrame(),window.addEventListener("resize",this.resizeIsDone),isInit=!0)}},{key:"resizeIsDone",value:function(){clearTimeout(resizeID),resizeID=setTimeout(this.refresh,200)}},{key:"proceedRequestAnimationFrame",value:function(){var t=this;_viewport.viewport.setViewportTop(this.customContainer),this.lastPosition!==_viewport.viewport.positions.top?(_viewport.viewport.setViewportBottom(),instances.forEach(function(e){t.proceedElement(e)}),frameID=window.requestAnimationFrame(this.proceedRequestAnimationFrame),this.lastPosition=_viewport.viewport.positions.top):frameID=window.requestAnimationFrame(this.proceedRequestAnimationFrame)}},{key:"proceedElement",value:function(e){(this.customContainer?e.checkIfVisible():e.isVisible)&&e.getTranslateValue()&&e.animate()}},{key:"refresh",value:function(){_viewport.viewport.setViewportAll(this.customContainer),instances.forEach(function(e){e.getElementOffset(),e.getRangeMax()}),this.lastPosition=-1}},{key:"destroy",value:function(){var t=this,r=[];instances=instances.filter(function(e){return t.elements.includes(e.element)?(r.push(e),!1):e}),r.forEach(function(e){e.unSetStyle(),!1===t.settings.overflow&&e.unWrapElement()}),instances.length||(window.cancelAnimationFrame(frameID),window.removeEventListener("resize",this.refresh),isInit=!1)}}]),i}();exports.default=SimpleParallax;